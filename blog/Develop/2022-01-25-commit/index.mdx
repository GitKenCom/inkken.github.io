---
slug: commit
title: commit
authors:
- name: å¤ä¸€
tags: ['å¼€å‘']
---

## Commit è§„èŒƒ

æœ¬æ–‡ä¸»è¦ä»‹ç»ä½¿ç”¨ git commit æäº¤ä»£ç æ—¶ message ä¹¦å†™è§„èŒƒåŠæ ¡éªŒçº¦æŸå·¥å…· commitlintï¼Œæ¨èéµå¾ª message è§„èŒƒã€‚

### git commit æäº¤è§„èŒƒ

#### 1.message æäº¤æ ¼å¼

åœ¨æ‰§è¡Œ git add . åï¼Œæ‰§è¡Œ git commit æ—¶ï¼Œä»£ç æœ‰å˜åŠ¨ï¼Œå¹¶éœ€è¦ç‰¹æ®Šè¯´æ˜æ›´æ”¹å†…å®¹æ—¶ï¼Œmessage ä¿¡æ¯éµå¾ªä¸‹æ–¹å®šä¹‰çš„æ ¼å¼ã€‚ï¼ˆå¦‚æ²¡æœ‰ç‰¹æ®Šæ›´æ”¹åŠè¯´æ˜å¯ä»¥ä½¿ç”¨ï¼š`git commit -m <message>` æäº¤ä»£ç ï¼‰ã€‚

ç¤ºä¾‹

```
git commit

feat(global): æ–°å¢æ”¯æŒè¡¨æ ¼é‡‘é¢åƒåˆ†ä½æ˜¾ç¤º

æ–°å¢ä»¥ä¸‹å†…å®¹ï¼š
- é‡‘é¢çš„å°æ•°ä½é»˜è®¤ä¿ç•™ä¸¤ä½å°æ•°
- é‡‘é¢çš„å°æ•°ä½æ²¡æœ‰çš„è¯è‡ªåŠ¨è¡¥2ä½0
- å¦‚æœéœ€è¦ä¿ç•™çš„ä¸æ˜¯2ä½çš„è¯è‡ªè¡Œæ”¹ä¸€ä¸‹ä½æ•°

Closes #122
```

æ³¨ï¼šissue#122ï¼šå®¢æˆ·åé¦ˆå¸Œæœ›è¡¨æ ¼ä¸­çš„é‡‘é¢ç”¨åƒåˆ†ä½å±•ç¤ºã€‚

##### message æ ¼å¼

```
<type>(<scope>): <subject>
<!-- ç©ºè¡Œ -->
<body>
<!-- ç©ºè¡Œ -->
<footer>
```

| å­—æ®µ | å¿…é¡» | è¯´æ˜ |
| --- | --- | --- |
| \*type | æ˜¯ | æäº¤ç±»åˆ« |
| scope | å¦ | ç”¨äºè¯´æ˜ commit å½±å“çš„èŒƒå›´ï¼Œå»ºè®®å¡«å†™å½±å“çš„åŠŸèƒ½æ¨¡å— |
| \*subject | æ˜¯ | commit ç›®çš„çš„ç®€çŸ­æè¿°ï¼Œä¸è¶…è¿‡ 50 ä¸ªå­—ç¬¦ |
| body | å¦(å»ºè®®å¡«å†™) | æè¿°å½“å‰ä¿®æ”¹çš„è¡Œä¸ºè¯¦ç»†ä¿¡æ¯æˆ–ä¿®æ”¹çš„ç›®çš„ |
| footer | å¦ | ä¸€èˆ¬ç”¨äºæè¿° BREAKING CHANGE æˆ–ä¿®å¤çš„ bug çš„é“¾æ¥ï¼Œåœ¨é¡¹ç›®å¼€å‘ä¸­ä¸€èˆ¬ä¸éœ€è¦å¡«å†™ï¼Œç»„ä»¶ç ”å‘çš„å·¥ç¨‹éœ€è¦å¡«å†™ |

###### \*type æäº¤ç±»åˆ«

å¿…å¡«ï¼Œtype åœ¨ commit çš„ message ä¸­æ˜¯å¿…é¡»å­˜åœ¨çš„ã€‚type å¯ä»¥æœ‰ä»¥ä¸‹å–å€¼ã€‚

| å€¼ | è¯´æ˜ |
| --- | --- |
| feat | æ–°åŠŸèƒ½ã€æ–°ç‰¹æ€§ |
| fix | ä¿®å¤ bug |
| docs | æ–‡æ¡£ä¿®æ”¹ |
| perf | æ›´æ”¹ä»£ç ï¼Œä»¥æé«˜æ€§èƒ½ï¼ˆåœ¨ä¸å½±å“ä»£ç å†…éƒ¨è¡Œä¸ºçš„å‰æä¸‹ï¼Œå¯¹ç¨‹åºæ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼‰ |
| style | ä»…ä»…ä¿®æ”¹äº†ç©ºæ ¼ã€æ ¼å¼ç¼©è¿›ã€é€—å·ç­‰ä»£ç æ ¼å¼ï¼Œä¸æ”¹å˜ä»£ç é€»è¾‘ï¼Œä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨ï¼Œæ³¨æ„ä¸æ˜¯æ ·å¼ä¿®æ”¹ |
| refactor | ä»£ç é‡æ„ï¼ˆé‡æ„ï¼Œåœ¨ä¸å½±å“ä»£ç å†…éƒ¨è¡Œä¸ºã€åŠŸèƒ½ä¸‹çš„ä»£ç ä¿®æ”¹ï¼‰ |
| test | æµ‹è¯•ç”¨ä¾‹æ–°å¢ã€ä¿®æ”¹ |
| revert | å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ |
| build | å½±å“é¡¹ç›®æ„å»ºæˆ–ä¾èµ–é¡¹ä¿®æ”¹ |
| ci | æŒç»­é›†æˆç›¸å…³æ–‡ä»¶ä¿®æ”¹ |
| workflow | å·¥ä½œæµç›¸å…³æ–‡ä»¶ä¿®æ”¹ |
| chore | å…¶ä»–ä¿®æ”¹ï¼ˆä¸åœ¨ä¸Šè¿°ç±»å‹ä¸­çš„ä¿®æ”¹ï¼‰ |

###### scope å½±å“èŒƒå›´

éå¿…å¡«ï¼ˆå»ºè®®å¡«å†™ï¼‰ï¼Œscope ç”¨äºè¯´æ˜ commit å½±å“çš„èŒƒå›´ï¼Œå»ºè®®å¡«å†™å½±å“çš„åŠŸèƒ½æ¨¡å—ã€‚å¦‚æœä¿®æ”¹å½±å“ä¸æ­¢ä¸€ä¸ª scopeï¼Œå¯ä»¥ä½¿ç”¨ \* ä»£æ›¿ã€‚

###### \*subject ç®€çŸ­æè¿°

å¿…å¡«ï¼Œcommit ç›®çš„çš„ç®€çŸ­æè¿°ï¼Œä¸è¶…è¿‡ 50 ä¸ªå­—ç¬¦ã€‚

â€¢ ä»¥åŠ¨è¯å¼€å¤´

â€¢ ç¬¬ä¸€ä¸ªå­—æ¯å°å†™

â€¢ ç»“å°¾ä¸åŠ å¥å·

###### body è¯¦ç»†ä¿¡æ¯

éå¿…å¡«ï¼ˆå»ºè®®å¡«å†™ï¼‰ï¼Œå¯æè¿°å½“å‰ä¿®æ”¹çš„è¡Œä¸ºè¯¦ç»†ä¿¡æ¯æˆ–ä¿®æ”¹çš„ç›®çš„ã€‚

###### footer å…¶ä»–ä¿¡æ¯

éå¿…å¡«ï¼Œä¸€èˆ¬ç”¨äºæè¿° BREAKING CHANGEï¼Œåœ¨é¡¹ç›®å¼€å‘ä¸­ä¸€èˆ¬ä¸éœ€è¦å¡«å†™ï¼Œç»„ä»¶ç ”å‘çš„å·¥ç¨‹éœ€è¦å¡«å†™ã€‚Footer éƒ¨åˆ†åªç”¨äºä¸¤ç§æƒ…å†µ

###### ï¼ˆ1ï¼‰ä¸å…¼å®¹å˜åŠ¨

å¦‚æœå½“å‰ä»£ç ä¸ä¸Šä¸€ä¸ªç‰ˆæœ¬ä¸å…¼å®¹ï¼Œåˆ™ Footer éƒ¨åˆ†ä»¥`BREAKING CHANGE`å¼€å¤´ï¼Œåé¢æ˜¯å¯¹å˜åŠ¨çš„æè¿°ã€ä»¥åŠå˜åŠ¨ç†ç”±å’Œè¿ç§»æ–¹æ³•ã€‚

```
BREAKING CHANGE: isolate scope bindings definition has changed.

    To migrate the code follow the example below:

    Before:

    scope: {
      attrData: 'attribute',
    }

    After:

    scope: {
      attrData: 'citcAttribute',
    }

    The removed `inject` wasn't generaly useful for directives so there should be no code usin
```

###### ï¼ˆ2ï¼‰å…³é—­ Issue

å¦‚æœå½“å‰ commit é’ˆå¯¹æŸä¸ª issueï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ Footer éƒ¨åˆ†å…³é—­è¿™ä¸ª issue ã€‚å¦‚æœæ˜¯å…³é—­ bugï¼Œå¯ä»¥æ”¾ä¸Šå¯¹åº” bug é“¾æ¥ã€‚

```
Closes #235
```

```
Closes #123, #245, #992
```

#### 2 ç¤ºä¾‹

##### fix

å¦‚æœä¿®å¤çš„è¿™ä¸ª bug åªå½±å“å½“å‰ä¿®æ”¹çš„æ–‡ä»¶ï¼Œå¯ä¸åŠ èŒƒå›´ã€‚å¦‚æœå½±å“çš„èŒƒå›´æ¯”è¾ƒå¤§ï¼Œè¦åŠ ä¸ŠèŒƒå›´æè¿°ã€‚

ä¾‹å¦‚è¿™æ¬¡ bug ä¿®å¤å½±å“åˆ°å…¨å±€ï¼Œå¯ä»¥åŠ ä¸ª globalã€‚å¦‚æœå½±å“çš„æ˜¯æŸä¸ªç›®å½•æˆ–æŸä¸ªåŠŸèƒ½ï¼Œå¯ä»¥åŠ ä¸Šè¯¥ç›®å½•çš„è·¯å¾„ï¼Œæˆ–è€…å¯¹åº”çš„åŠŸèƒ½åç§°ã€‚

// ç¤ºä¾‹ 1

fix(global): ä¿®å¤ checkbox ä¸èƒ½å¤é€‰çš„é—®é¢˜

// ç¤ºä¾‹ 2 ä¸‹é¢åœ†æ‹¬å·é‡Œçš„ order ä¸ºè®¢å•æ¨¡å—çš„åç§°ã€‚

fix(order): ä¿®å¤é¡µé¢é¡¶éƒ¨æç¤ºè¯­å­—ä½“è¿‡å°çš„ bugï¼Œå°†è®¢å•æ¨¡å—ä¸‹æ‰€æœ‰é¡µé¢é¡¶éƒ¨æç¤ºè¯­çš„é»˜è®¤å­—ä½“å¤§å°ä¿®æ”¹ä¸º 14px

// ç¤ºä¾‹ 3

fix: value.length -> values.length

// ç¤ºä¾‹ 4 åœ¨å®é™…å¼€å‘ä¸­ä¸€èˆ¬ä¼šä½¿ç”¨é¡¹ç›®ç®¡ç†å·¥å…·æ¯”å¦‚ç¦…é“ï¼Œè¿™ä¸ªæ—¶å€™ä¿®å¤ bugï¼Œéœ€è¦å¸¦ä¸Š bugIDã€‚

fix: bug*5788 ã€è®¢å•ç®¡ç†*è®¢å•å°è´¦ã€‘åˆ‡æ¢é»˜è®¤æ¡æ•°ååˆè®¡æ•°æ˜¾ç¤ºä¸åˆ‡æ¢å‰çš„æ ¼å¼å±•ç¤ºä¸ä¸€è‡´

##### feat

// ç¤ºä¾‹ 1 ä¸æ¨èï¼Œæ²¡æœ‰æäº¤ç±»å‹ï¼ŒåŠŸèƒ½æè¿°ä¸æ˜¯å¾ˆæ¸…æ™°ã€‚å†…å®¹è¾ƒå¤šæ—¶å¯ä»¥ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼Œå…·ä½“å†…å®¹å†™åœ¨ body ä¸­ã€‚

ä¿®æ”¹æ–°å¢ æ•°æ®ç»Ÿè®¡ tab åˆ‡æ¢

//ç¤ºä¾‹ 2

feat: æ–°å¢åˆ†å…¬å¸è®¡åˆ’æ”¶å…¥æ¨¡å—

##### chore

chore çš„ä¸­æ–‡ç¿»è¯‘ä¸ºæ—¥å¸¸äº‹åŠ¡ã€ä¾‹è¡Œå·¥ä½œï¼Œé¡¾åæ€ä¹‰ï¼Œå³ä¸åœ¨å…¶ä»– commit ç±»å‹ä¸­çš„ä¿®æ”¹ï¼Œéƒ½å¯ä»¥ç”¨ chore è¡¨ç¤ºã€‚

chore: å°†è¡¨æ ¼ä¸­çš„æŸ¥çœ‹è¯¦æƒ…æ”¹ä¸ºè¯¦æƒ…

### Git Commit å¼ºåˆ¶è§„èŒƒå·¥å…·ï¼ˆcommitlint+huskyï¼‰

#### é…ç½®æ­¥éª¤æ±‡æ€»

- å®‰è£… commitlint å’Œ husky

```
npm install --save-dev @commitlint/config-conventional @commitlint/cli husky@4.3.8
```

- æ ¹ç›®å½•åˆ›å»º commitlint.config.js

```js
module.exports = { extends: ['@commitlint/config-conventional'] };
```

- package.json æ·»åŠ  hooks å®ç° commit æ—¶æ£€æŸ¥

```
{
  "devDependencies": {
  ...
  },
  "husky": {
    "hooks": {
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
 }
 ...
}
```

#### 1. commitlint

commitlint æ˜¯å½“å‰ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ git commit æ ¡éªŒçº¦æŸå·¥å…·ä¹‹ä¸€ï¼Œåœ¨å¤šäººåä½œçš„èƒŒæ™¯ä¸‹ï¼Œæ¨èä½¿ç”¨ commitlint + husky è§„èŒƒ git commit -m "" ä¸­çš„æè¿°ä¿¡æ¯ã€‚commitlint ä¸»è¦ç”¨é€”æ˜¯åœ¨æˆ‘ä»¬è¿è¡Œ `git commmit -m 'xxx'` æ—¶ï¼Œç”¨æ¥æ£€æŸ¥ `xxx` æ˜¯å¦æ»¡è¶³å›ºå®šæ ¼å¼ã€‚

##### å®‰è£…åŠç”Ÿæˆé…ç½®æ–‡ä»¶

commitlint: å®‰è£…åŠç”Ÿæˆé…ç½®æ–‡ä»¶

```
// å®‰è£…
npm install -g @commitlint/cli @commitlint/config-conventional
// ç”Ÿæˆé…ç½®æ–‡ä»¶
echo "module.exports = {extends: ['@commitlint/config-conventional']}" > commitlint.config.js
æˆ–è€…
yarn add  @commitlint/config-conventional @commitlint/cli -D
echo "module.exports = {extends: ['@commitlint/config-conventional']}" > commitlint.config.js
```

config-conventional æ˜¯ç¤¾åŒºæ•´ç†çš„å¸¸ç”¨çš„ Commit è§„èŒƒï¼Œè§å¦‚ä¸‹

https://www.npmjs.com/package/@commitlint/config-conventional

é»˜è®¤é‡‡ç”¨ config-conventionalï¼š

```
module.exports = {extends: ['@commitlint/config-conventional']}
```

å¯è‡ªå®šä¹‰é…ç½®ï¼š

é…ç½®è§„åˆ™è§ https://commitlint.js.org/#/reference-configuration

```
module.exports = {
    extends: ['@commitlint/config-conventional'],
    rules: {
        'type-enum': [2, 'always', [
            "feat", "upd", "del", "fix", "refactor", "test", "perf", "docs", "style", "revert"
        ]],
        'subject-full-stop': [0, 'never'],
        'subject-case': [0, 'never']
    }
}
```

#### 2. husky

Husky can prevent bad git commit, git push and more ğŸ¶ woof!

husky æ˜¯ä¸€ä¸ªå¢å¼ºçš„ git hook å·¥å…·ï¼Œå¯ä»¥åœ¨ git hook çš„å„ä¸ªé˜¶æ®µæ‰§è¡Œæˆ‘ä»¬åœ¨ package.json ä¸­é…ç½®å¥½çš„ npm scriptã€‚

å€ŸåŠ© husky åœ¨æ¯æ¬¡ commit æ—¶æ‰§è¡Œ commitlint æ¥æ£€æŸ¥æˆ‘ä»¬è¾“å…¥çš„ messageã€‚

##### 2.1 å®‰è£…

**æ³¨æ„**ï¼šæŒ‡å®š-g ä¹Ÿä¸å¯¹æ‰€æœ‰ Project ç”Ÿæ•ˆï¼æ¯ä¸ª Project éƒ½éœ€è¦é‡æ–°å®‰è£… huskyã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹æ˜¯å®‰è£…æœ€æ–°`husky`ç‰ˆæœ¬ä¼šæœ‰å„ç§å„æ ·é—®é¢˜, å»ºè®®å¤§å®¶å®‰è£… `4.3.8`ç‰ˆæœ¬ï¼Œå¯ä»¥ç¡®ä¿æ²¡æœ‰é—®é¢˜ã€‚

```
npm install husky@4.3.8 -D -g
æˆ–è€…
yarn add husky@4.3.8 -D
```

##### 2.2 é…ç½®

åœ¨ package.json ä¸­é…ç½® huskyï¼Œcommit-msg æŒ‡å®šä¸º commitlint ï¼ˆå°†åœ¨ git hook çš„ commit-msg é˜¶æ®µè°ƒç”¨ commitlint ï¼‰ã€‚

```
"devDependencies": {
...
},
"husky": {
    "hooks": {
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
 }
```

å®‰è£…é…ç½®å®Œæˆåï¼Œå½“æˆ‘ä»¬åœ¨å½“å‰é¡¹ç›®ä¸­æ‰§è¡Œ git commit -m 'æµ‹è¯•æäº¤' æ—¶å°†è§¦å‘ commit-msg äº‹ä»¶é’©å­å¹¶é€šçŸ¥ huskyï¼Œä»è€Œæ‰§è¡Œ commitlint -E HUSKY_GIT_PARAMS å‘½ä»¤ï¼Œå®ƒå°†è¯»å– commitlint.config.js é…ç½®è§„åˆ™å¹¶å¯¹æˆ‘ä»¬åˆšåˆšæäº¤çš„æµ‹è¯•æäº¤è¿™ä¸²æ–‡å­—è¿›è¡Œæ ¡éªŒï¼Œè‹¥æ ¡éªŒé€šè¿‡ï¼Œåˆ™å®Œæˆ commit æäº¤ã€‚è‹¥æ ¡éªŒä¸é€šè¿‡ï¼Œåˆ™åœ¨ç»ˆç«¯è¾“å‡ºé”™è¯¯ï¼Œcommit ç»ˆæ­¢ã€‚

ç¤ºä¾‹

```
git commit -m "xxx"
husky > commit-msg (node v14.18.3)
â§—   input: xxx
âœ–   subject may not be empty [subject-empty]
âœ–   type may not be empty [type-empty]

âœ–   found 2 problems, 0 warnings
â“˜   Get help: https://github.com/conventional-changelog/commitlint/#what-is-commitlint

husky > commit-msg hook failed (add --no-verify to bypass)
```

```
git commit -m "feat:  æµ‹è¯•æäº¤"
husky > commit-msg (node v14.18.3)
[master 3f60f34] feat: æµ‹è¯•æäº¤
2 files changed, 8 insertions(+), 1 deletion(-)
```

### ä½¿ç”¨ Commitizen å®ç°è§„èŒƒæäº¤

ä¸Šé¢ä»‹ç»äº†è§„èŒƒæäº¤çš„æ ¼å¼å’Œæ ¡éªŒçº¦æŸå·¥å…·ï¼Œå¦‚æœåœ¨ git commit çš„æ—¶å€™ä¸¥æ ¼æŒ‰ç…§ä¸Šé¢çš„è§„èŒƒæ¥å†™ï¼Œéœ€è¦è®°ä½ä¸åŒçš„ç±»å‹åˆ°åº•æ˜¯ç”¨æ¥å®šä¹‰ä»€ä¹ˆçš„ï¼Œsubject æ€ä¹ˆå†™ï¼Œbody æ€ä¹ˆå†™ï¼Œfooter è¦ä¸è¦å†™ã€‚å¿ƒæ™ºæ˜¯æœ‰è´Ÿæ‹…çš„ã€‚ä¸‹é¢æ¨èä¸€ä¸ªå·¥å…·åœ¨æäº¤çš„æ—¶å€™æ¥æç¤ºå¿…å¡«å­—æ®µã€‚

#### Commitizen

```
Zen-like commit messages for internet citizens.
```

Commitizen æ˜¯ä¸€ä¸ªå¸®åŠ©æ’°å†™è§„èŒƒ commit messages çš„æç¤ºå·¥å…·ã€‚

##### 1.å®‰è£…å’Œåˆå§‹åŒ–

```
# ç¬¬ä¸€æ­¥åœ¨å·¥ä½œç›®å½•å®‰è£… cz-relax
npm install cz-relax --save-dev
# ç¬¬äºŒæ­¥åˆå§‹åŒ–ä¸­æ–‡é…ç½®ï¼Œå¦‚æœæŠ¥é”™æç¤ºéœ€è¦ä½¿ç”¨forceï¼Œè¯·åœ¨æœ€åæ·»åŠ  --force
npx cz-relax init --language zh
```

##### 2.è¿è¡Œ git cz æ•ˆæœ

```
git add .
git cz

cz-cli@4.2.5, cz-git@1.3.10

? é€‰æ‹©ä½ è¦æäº¤çš„ç±»å‹ : Use arrow keys or type to search
â¯ feat:     æ–°å¢åŠŸèƒ½ | A new feature
  fix:      ä¿®å¤ç¼ºé™· | A bug fix
  docs:     æ–‡æ¡£æ›´æ–° | Documentation only changes
  style:    ä»£ç æ ¼å¼ | Changes that do not affect the meaning of the code
  refactor: ä»£ç é‡æ„ | A code change that neither fixes a bug nor adds a feature
  perf:     æ€§èƒ½æå‡ | A code change that improves performance
  test:     æµ‹è¯•ç›¸å…³ | Adding missing tests or correcting existing tests
(Move up and down to reveal more choices)

? é€‰æ‹©ä½ è¦æäº¤çš„ç±»å‹ : feat:     æ–°å¢åŠŸèƒ½ | A new feature
? é€‰æ‹©ä¸€ä¸ªæäº¤èŒƒå›´ï¼ˆå¯é€‰ï¼‰: empty
? å¡«å†™ç®€çŸ­ç²¾ç‚¼çš„å˜æ›´æè¿° :
 [Infinity more chars allowed]
 æ–°å¢å…¬å¸æ”¶å…¥å°è´¦æ¨¡å—
? å¡«å†™æ›´åŠ è¯¦ç»†çš„å˜æ›´æè¿°ï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨ "|" æ¢è¡Œ :

? åˆ—ä¸¾å…³è”issue (å¯é€‰) ä¾‹å¦‚: #31, #I3244 :

###--------------------------------------------------------###
feat: æ–°å¢å…¬å¸æ”¶å…¥å°è´¦æ¨¡å—
###--------------------------------------------------------###

? æ˜¯å¦æäº¤æˆ–ä¿®æ”¹commit ? (Yneh)
......
```



â€”ENDâ€”
